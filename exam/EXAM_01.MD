# ПРОМЕЖУТОЧНАЯ АТТЕСТАЦИЯ 1

Исполнитель: Боталов Константин Владимирович

## Постановка задания

1. Вы успешно устроились на работу специалистом по SQL, но вдруг начальство решило передать вам наработки другого специалиста по разработке БД для социальной сети. Вам надо проанализировать код в файле [create.txt](src/create.txt), обдумать как можно улучшить данную БД.
2. Вы должны описать текстом какая информация содержится в каждой таблице, объяснить смысл каждого внешнего ключа. И сразу же отметить, что можно улучшить.
3. Разработайте логическую модель БД, уже включая ваши улучшения.
4. Измените код создания и наполнения БД в соответствии с вашими предложениями, запустите его.
5. Найдите всех друзей пользователя с id = 1.
6. Найдите все сообщения, в которых принимал участие пользователь id = 1.
7. Найдите всех пользователей, кто состоит в сообществе 'beatae’.
8. Найдите всех пользователей, кто отправлял сообщение содержащее слово 'culpa'.
9. (сложное необязательное) Найдите друзей друзей пользователя с id = 1.

## Выполнение задания

### Анализ таблиц и их улучшение

В этой структуре базы данных для социальной сети мы имеем пять таблиц: **users**, **messages**, **friend_requests**, **communities** и **users_communities**.

#### Описание таблиц

1. Таблица **'users' (Пользователи)**:
    - **Содержимое:**
        - **id:** уникальный идентификатор пользователя (первичный ключ).
        - **firstname:** имя пользователя.
        - **lastname:** фамилия пользователя.
        - **email:** адрес электронной почты пользователя (должен быть уникальным).
    - **Назначение:** хранение основных данных о пользователе.
    - **Внешние ключи:** отсутствуют.

2. Таблица **'messages' (Сообщения)**:
    - **Содержимое:**
        - **id:** уникальный идентификатор сообщения (первичный ключ).
        - **from_user_id:** идентификатор пользователя, отправившего сообщение.
        - **to_user_id:** идентификатор пользователя, получившего сообщение.
        - **body:** текст сообщения.
        - **created_at:** временная метка создания сообщения.
    - **Назначение:** хранение сообщений между пользователями.
    - **Внешние ключи:**
        - **from_user_id** и **to_user_id** ссылаются на **users(id)** для отслеживания пользователя-отправителя и пользователя-получателя сообщения.

3. Таблица **'friend_requests' (Запросы в друзья)**:

    - **Содержимое:**
        - **initiator_user_id:** идентификатор пользователя, который отправил запрос на дружбу.
        - **target_user_id:** идентификатор пользователя, которому отправлен запрос.
        - **status:** статус запроса.
        - **requested_at:** временная метка, когда был отправлен запрос.
        - **updated_at:** временная метка последнего обновления статуса запроса.
    - **Назначение:** хранение информации о запросах в друзья между пользователями.
    - **Внешние ключи:**
        - **initiator_user_id** и **target_user_id** ссылаются на **users(id)**, что позволяет отслеживать пользователя-инициатора и пользователя получателя запроса.

4. Таблица **'communities'**:

    - **Содержимое:**
        - **id:** уникальный идентификатор группы (первичный ключ).
        - **name:** название группы.
    - **Назначение:** хранение информации о группах в социальной сети.
    - **Внешние ключи:** отсутствуют.

5. Таблица **'users_communities'**:

    - **Содержимое:**
        - **user_id:** идентификатор пользователя, присоединенного к группе.
        - **community_id:** идентификатор группы.
    - **Назначение:** соединение пользователей с группами, к которым они присоединились.
    - **Внешние ключи:**
      - **user_id** ссылается на **users(id)**, а **community_id** ссылается на **communities(id)** для отслеживания какие пользователи входят в какие группы.

#### Возможные улучшения

1. Статус сообщений:
   - Можно добавить поле **status** в таблицу **messages**, чтобы отслеживать, было ли сообщение доставлено, прочитано или удалено. Произвести нормализацию таких статусов.
2. Временные метки:
   - Добавить поля **updated_at** к таблицам **users** и **communities**, чтобы отслеживать время последнего изменения.
   - Добавить поле **created_at** в таблице **users** для записи времени создания учётной записи.
   - Добавить поле **joined_at** в таблице **users_communities** для хранения времени присоединения к группе.
3. Нормализация статусов:
   - Для поля **status** в таблице **friend_requests** можно создать отдельную таблицу со статусами, что уменьшит количество возможных ошибок и дублирования данных.
4. Дополнительные поля:
   - В таблице **users** можно добавить дополнительные поля **profile_picture** и **bio** для обогащения профиля пользователя.
   - В таблице **users** можно добавить дополнительное поле **password_hash** для хранения хешированного пароля.
   - В таблице **messages** добавить дополнительное поле **type** для различения текстовых и мультимедийных сообщений.
   - В таблице **communities** добавить дополнительное поле **description** для размещения краткой информации о сообществе.
   - В таблице **users_communities** добавить дополнительное поле **role** для обозначения роли пользователя в сообществе (например, администратор, участник).
   - В таблицах **friend_requests** и **users_communities** добавить уникальный идентификатор строки с первичным ключом по одному полю для исключения ситуаций с удалением дублированных строк и удобства администрирования. Составные первичные ключи удалить.

### Логическая модель базы данных

Построим логическую модель новой базы данных:

